@version: 3.38

# --- SOURCE: listen for UDP syslog on 0.0.0.0:514
source s_udp {
  syslog(transport("udp") ip("0.0.0.0") port(514));
  # Alternatively: udp(ip("0.0.0.0") port(514));
};

# --- (optional) accept TCP too while testing
# source s_tcp { syslog(transport("tcp") ip("0.0.0.0") port(514)); };

# --- DEST: post to EDA webhook
destination d_eda {
  http(
    url("http://44.224.14.24:5003/endpoint")
    method("POST")
    headers("Content-Type: application/json", "Authorization: Bearer splunktoken")
    body("$(format-json time='$ISODATE' host='$HOST' program='$PROGRAM' message='$MSG' percent_used='${percent_used}')")

    # TEST SETTINGS: send immediately
    batch-lines(1)           # send each event now
    batch-timeout(1000)      # 1s max wait if batching kicks in
    workers(1)               # keep simple while testing

    # Reliability (OK to keep)
    retries(1000)
    timeout(10)
    time-reopen(5)

    # Buffering (OK to keep)
    disk-buffer(reliable(yes)
                dir("/var/lib/syslog-ng/buffer")
                disk-buf-size(1073741824)
                mem-buf-length(10000)
                prealloc(yes))

    persist-name("eda-http-dest")
  );
};

# --- LOG PATH: wire source -> dest
log {
  source(s_udp);
  destination(d_eda);
  flags(flow-control);
};

# If you enabled s_tcp above:
# log { source(s_tcp); destination(d_eda); flags(flow-control); };